<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta name="description" content="Share my favorite">
<meta property="og:type" content="website">
<meta property="og:title" content="Vin&#39;s Blog">
<meta property="og:url" content="https://wax8280.github.io/page/6/index.html">
<meta property="og:site_name" content="Vin&#39;s Blog">
<meta property="og:description" content="Share my favorite">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vin&#39;s Blog">
<meta name="twitter:description" content="Share my favorite">






  <link rel="canonical" href="https://wax8280.github.io/page/6/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>Vin's Blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?696e48752c03b0066c07d25947ac5dff";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Vin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/859/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/859/" itemprop="url">每天一道编程题——最长递增子序列</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T19:17:38+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">先看复杂度为O(N^<span class="number">2</span>)的简单版本</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">复杂度为O(N^2)的方法，算法很简单。dp[i]表示在以arr[i]这个数结尾的情况下，arr[0....i]中的最大递增子序列</span></div><div class="line"><span class="string">'''</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdp1</span><span class="params">(arr)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [<span class="number">0</span>] * n</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i] = <span class="number">1</span></div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</div><div class="line">            <span class="keyword">if</span> arr[i] &gt; arr[j]:</div><div class="line">                dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> dp</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateLIS</span><span class="params">(arr, dp)</span>:</span></div><div class="line">    n = max(dp)</div><div class="line">    index = dp.index(n)</div><div class="line">    lis = [<span class="number">0</span>] * n</div><div class="line">    n -= <span class="number">1</span></div><div class="line">    lis[n] = arr[index]</div><div class="line">    <span class="comment"># 从右向左</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(index, <span class="number">0</span> - <span class="number">1</span>, <span class="number">-1</span>):</div><div class="line">        <span class="comment"># 关键</span></div><div class="line">        <span class="keyword">if</span> arr[i] &lt; arr[index] <span class="keyword">and</span> dp[i] == dp[index] - <span class="number">1</span>:</div><div class="line">            n -= <span class="number">1</span></div><div class="line">            lis[n] = arr[i]</div><div class="line">            index = i</div><div class="line">    <span class="keyword">return</span> lis</div></pre></td></tr></table></figure>
<p>getdp函数的复杂度太高，我们尝试下将其降到O(NlogN)</p>
<p>我们利用二分查找的思想<br>我们试着用一个数组ends保存，在所有长度为i的递增序列中，最小的结尾数为ends[i-1]<br>初始化一个ends[]和一个int型right，并规定ends[0,…,right]为有效区，否则为无效区<br>遍历arr，假设当前为i，<br>在ends的有效区从最左边开始找，找到大于arr[i]的数，则表示arr[i]结尾的最长递增序列长度=right+1<br>最后还有修改ends对应的值为arr[i]，以便下次遍历</p>
<p>如<br>arr = [2, 1, 5, 3, 6, 4, 8, 9, 7]<br>ends[0]=arr[0]=2<br>right=0<br>i=1,ends有效区=[2]<br>从左开始,ends[0]&gt;arr[1],<br>表示arr[i]结尾的最长递增序列长度=right+1=1,<br>ends[0]=arr[1]=1<br>i=2,ends有效区=[1]<br>从左开始,ends[0]&lt;arr[2],<br>没有发现，最长递增序列长度=right+1=2<br>right++<br>ends[right]=arr[2]<br>i=3,ends有效区=[1,5]<br>从左开始,ends[1]&gt;arr[3],<br>表示arr[i]结尾的最长递增序列长度=right+1=2,<br>ends[0]=arr[3]=3<br>i=4,ends有效区=[1,3]<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdp2</span><span class="params">(arr)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp, ends = [<span class="number">0</span>] * n, [<span class="number">0</span>] * n</div><div class="line">    ends[<span class="number">0</span>], dp[<span class="number">0</span>] = arr[<span class="number">0</span>], <span class="number">1</span></div><div class="line">    right, l, r, m = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        l = <span class="number">0</span></div><div class="line">        r = right</div><div class="line">        <span class="comment"># 二分查找,若找不到则ends[l或r]是比arr[i]大而又最接近其的数</span></div><div class="line">        <span class="comment"># 若arr[i]比ends有效区的值都大，则l=right+1</span></div><div class="line">        <span class="keyword">while</span> l &lt;= r:</div><div class="line">            m = (l + r) / <span class="number">2</span></div><div class="line">            <span class="keyword">if</span> arr[i] &gt; ends[m]:</div><div class="line">                l = m + <span class="number">1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                r = m - <span class="number">1</span></div><div class="line">        right = max(right, l)</div><div class="line">        ends[l] = arr[i]</div><div class="line">        dp[i] = l + <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> dp</div></pre></td></tr></table></figure></p>
<hr>
<p>别小看了从O(N^2)到O(NlogN)<br>在8000的规模下<br>算法1和算法2的运行时间为8.28299999237和0.0190000534058<br>两者相差436倍！！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/target/859/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/target/859/" itemprop="url">每天一道编程题——最长递增子序列</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T19:17:38+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">先看复杂度为O(N^<span class="number">2</span>)的简单版本</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">复杂度为O(N^2)的方法，算法很简单。dp[i]表示在以arr[i]这个数结尾的情况下，arr[0....i]中的最大递增子序列</span></div><div class="line"><span class="string">'''</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdp1</span><span class="params">(arr)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [<span class="number">0</span>] * n</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i] = <span class="number">1</span></div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</div><div class="line">            <span class="keyword">if</span> arr[i] &gt; arr[j]:</div><div class="line">                dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> dp</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateLIS</span><span class="params">(arr, dp)</span>:</span></div><div class="line">    n = max(dp)</div><div class="line">    index = dp.index(n)</div><div class="line">    lis = [<span class="number">0</span>] * n</div><div class="line">    n -= <span class="number">1</span></div><div class="line">    lis[n] = arr[index]</div><div class="line">    <span class="comment"># 从右向左</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(index, <span class="number">0</span> - <span class="number">1</span>, <span class="number">-1</span>):</div><div class="line">        <span class="comment"># 关键</span></div><div class="line">        <span class="keyword">if</span> arr[i] &lt; arr[index] <span class="keyword">and</span> dp[i] == dp[index] - <span class="number">1</span>:</div><div class="line">            n -= <span class="number">1</span></div><div class="line">            lis[n] = arr[i]</div><div class="line">            index = i</div><div class="line">    <span class="keyword">return</span> lis</div></pre></td></tr></table></figure>
<p>getdp函数的复杂度太高，我们尝试下将其降到O(NlogN)</p>
<p>我们利用二分查找的思想<br>我们试着用一个数组ends保存，在所有长度为i的递增序列中，最小的结尾数为ends[i-1]<br>初始化一个ends[]和一个int型right，并规定ends[0,…,right]为有效区，否则为无效区<br>遍历arr，假设当前为i，<br>在ends的有效区从最左边开始找，找到大于arr[i]的数，则表示arr[i]结尾的最长递增序列长度=right+1<br>最后还有修改ends对应的值为arr[i]，以便下次遍历</p>
<p>如<br>arr = [2, 1, 5, 3, 6, 4, 8, 9, 7]<br>ends[0]=arr[0]=2<br>right=0<br>i=1,ends有效区=[2]<br>从左开始,ends[0]&gt;arr[1],<br>表示arr[i]结尾的最长递增序列长度=right+1=1,<br>ends[0]=arr[1]=1<br>i=2,ends有效区=[1]<br>从左开始,ends[0]&lt;arr[2],<br>没有发现，最长递增序列长度=right+1=2<br>right++<br>ends[right]=arr[2]<br>i=3,ends有效区=[1,5]<br>从左开始,ends[1]&gt;arr[3],<br>表示arr[i]结尾的最长递增序列长度=right+1=2,<br>ends[0]=arr[3]=3<br>i=4,ends有效区=[1,3]<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdp2</span><span class="params">(arr)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp, ends = [<span class="number">0</span>] * n, [<span class="number">0</span>] * n</div><div class="line">    ends[<span class="number">0</span>], dp[<span class="number">0</span>] = arr[<span class="number">0</span>], <span class="number">1</span></div><div class="line">    right, l, r, m = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        l = <span class="number">0</span></div><div class="line">        r = right</div><div class="line">        <span class="comment"># 二分查找,若找不到则ends[l或r]是比arr[i]大而又最接近其的数</span></div><div class="line">        <span class="comment"># 若arr[i]比ends有效区的值都大，则l=right+1</span></div><div class="line">        <span class="keyword">while</span> l &lt;= r:</div><div class="line">            m = (l + r) / <span class="number">2</span></div><div class="line">            <span class="keyword">if</span> arr[i] &gt; ends[m]:</div><div class="line">                l = m + <span class="number">1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                r = m - <span class="number">1</span></div><div class="line">        right = max(right, l)</div><div class="line">        ends[l] = arr[i]</div><div class="line">        dp[i] = l + <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> dp</div></pre></td></tr></table></figure></p>
<hr>
<p>别小看了从O(N^2)到O(NlogN)<br>在8000的规模下<br>算法1和算法2的运行时间为8.28299999237和0.0190000534058<br>两者相差436倍！！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/855/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/855/" itemprop="url">Python设计模式——外观模式（门面模式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T13:38:05+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>假设你去买东西，你肯定是问店主，因为店主对这家店的货物分布比你熟悉，然后店主把你需要的东西交给你，就这么简单。</p>
<p><div align="center"><br><img src="./interface-800x392.png" alt=""><br></div><br>要求一个子系统的外部与其内部的通信必须通过一个统一的对象进行。外观模式提供一个高层次的接口，使得子系统更易于使用。</p>
<p><em>It provides a unified interface to a set of interfaces in a subsystem and defines a highlevel interface that helps the client use the subsystem in an easy way.</em></p>
<p>除了这个接口不允许有任何访问子系统的行为发生。<br>Facade门面角色：客户端可以调用这个角色的方法。次角色知晓子系统的所有功能和责任。一般情况下，本角色会将所有从客户端发来的请求委派到相应的子系统去，也就是说该角色没有实际的业务逻辑，只是一个委托类。<br>subsystem子系统角色：每一个子系统都不是一个单独的类，而是一个类的集合。子系统不知道门面的存在。对于子系统而言，门面仅仅是另外一个客户端而已。</p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">你 向 Manager 询问，Manager回答你，你不用关心里面的细节</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventManager</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Event Manager:: Let me talk to the folks\n"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">arrange</span><span class="params">(self)</span>:</span></div><div class="line">        self.hotelier = Hotelier()</div><div class="line">        self.hotelier.bookHotel()</div><div class="line">        self.florist = Florist()</div><div class="line">        self.florist.setFlowerRequirements()</div><div class="line">        self.caterer = Caterer()</div><div class="line">        self.caterer.setCuisine()</div><div class="line">        self.musician = Musician()</div><div class="line">        self.musician.setMusicType()</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hotelier</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Arranging the Hotel for Marriage? --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__isAvailable</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Is the Hotel free for the event on given day?"</span>)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bookHotel</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.__isAvailable():</div><div class="line">            print(<span class="string">"Registered the Booking\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Florist</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Flower Decorations for the Event? --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setFlowerRequirements</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Carnations, Roses and Lilies would be used for Decorations\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caterer</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Food Arrangements for the Event --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setCuisine</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Chinese &amp; Continental Cuisine to be served\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Musician</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Musical Arrangements for the Marriage --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setMusicType</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Jazz and Classical will be played\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">You</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Whoa! Marriage Arrangements??!!!"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">askEventManager</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Let's Contact the Event Manager\n\n"</span>)</div><div class="line">        em = EventManager()</div><div class="line">        em.arrange()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Thanks to Event Manager, all preparations done!Phew!"</span>)</div><div class="line">        </div><div class="line">you = You()</div><div class="line">you.askEventManager()</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">You:: Whoa! Marriage Arrangements??!!!</span></div><div class="line"><span class="string">You:: Let's Contact the Event Manager</span></div><div class="line"><span class="string">Event Manager:: Let me talk to the folks</span></div><div class="line"><span class="string">Arranging the Hotel for Marriage? --</span></div><div class="line"><span class="string">Is the Hotel free for the event on given day?</span></div><div class="line"><span class="string">Registered the Booking</span></div><div class="line"><span class="string">Flower Decorations for the Event? --</span></div><div class="line"><span class="string">Carnations, Roses and Lilies would be used for Decorations</span></div><div class="line"><span class="string">Food Arrangements for the Event --</span></div><div class="line"><span class="string">Chinese &amp; Continental Cuisine to be served</span></div><div class="line"><span class="string">Musical Arrangements for the Marriage --</span></div><div class="line"><span class="string">Jazz and Classical will be played</span></div><div class="line"><span class="string">You:: Thanks to Event Manager, all preparations done!Phew!</span></div><div class="line"><span class="string">'''</span></div></pre></td></tr></table></figure>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>减少了系统的相互依赖。所有的依赖都是对门面对象的依赖，与子系统无关</li>
<li>提高灵活性，不管子系统内部如何变化，只要不影响到门面对象，任你自由活动</li>
<li>提高安全性</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>不符合开闭原则，对修改关闭，对扩展开放。唯一能做的就只有修改门面角色的代码。</li>
</ul>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul>
<li>为一个复杂的模块或子系统提供一个供外界访问的接口</li>
<li>子系统相对独立——外界对子系统的访问只要黑箱操作即可</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>一个子系统可以有多个门面</li>
<li>门面不参与子系统内的业务逻辑</li>
<li>门面只是提供一个访问子系统的一个路径，它不应该也不能参与具体的业务逻辑，否则会产生一个倒依赖的问题：子系统必须依赖门面才能被访问。</li>
<li>门面不能常变，而业务常变</li>
<li>解决方法，可以将具体的业务封装在一个类中，封装完毕后提供给门面对象调用。（试下修改代码中的arrange？）</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/target/855/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/target/855/" itemprop="url">Python设计模式——外观模式（门面模式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T13:38:05+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>假设你去买东西，你肯定是问店主，因为店主对这家店的货物分布比你熟悉，然后店主把你需要的东西交给你，就这么简单。</p>
<p><div align="center"><br><img src="./interface-800x392.png" alt=""><br></div><br>要求一个子系统的外部与其内部的通信必须通过一个统一的对象进行。外观模式提供一个高层次的接口，使得子系统更易于使用。</p>
<p><em>It provides a unified interface to a set of interfaces in a subsystem and defines a highlevel interface that helps the client use the subsystem in an easy way.</em></p>
<p>除了这个接口不允许有任何访问子系统的行为发生。<br>Facade门面角色：客户端可以调用这个角色的方法。次角色知晓子系统的所有功能和责任。一般情况下，本角色会将所有从客户端发来的请求委派到相应的子系统去，也就是说该角色没有实际的业务逻辑，只是一个委托类。<br>subsystem子系统角色：每一个子系统都不是一个单独的类，而是一个类的集合。子系统不知道门面的存在。对于子系统而言，门面仅仅是另外一个客户端而已。</p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">你 向 Manager 询问，Manager回答你，你不用关心里面的细节</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventManager</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Event Manager:: Let me talk to the folks\n"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">arrange</span><span class="params">(self)</span>:</span></div><div class="line">        self.hotelier = Hotelier()</div><div class="line">        self.hotelier.bookHotel()</div><div class="line">        self.florist = Florist()</div><div class="line">        self.florist.setFlowerRequirements()</div><div class="line">        self.caterer = Caterer()</div><div class="line">        self.caterer.setCuisine()</div><div class="line">        self.musician = Musician()</div><div class="line">        self.musician.setMusicType()</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hotelier</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Arranging the Hotel for Marriage? --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__isAvailable</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Is the Hotel free for the event on given day?"</span>)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bookHotel</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.__isAvailable():</div><div class="line">            print(<span class="string">"Registered the Booking\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Florist</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Flower Decorations for the Event? --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setFlowerRequirements</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Carnations, Roses and Lilies would be used for Decorations\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caterer</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Food Arrangements for the Event --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setCuisine</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Chinese &amp; Continental Cuisine to be served\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Musician</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Musical Arrangements for the Marriage --"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setMusicType</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Jazz and Classical will be played\n\n"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">You</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Whoa! Marriage Arrangements??!!!"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">askEventManager</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Let's Contact the Event Manager\n\n"</span>)</div><div class="line">        em = EventManager()</div><div class="line">        em.arrange()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"You:: Thanks to Event Manager, all preparations done!Phew!"</span>)</div><div class="line">        </div><div class="line">you = You()</div><div class="line">you.askEventManager()</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">You:: Whoa! Marriage Arrangements??!!!</span></div><div class="line"><span class="string">You:: Let's Contact the Event Manager</span></div><div class="line"><span class="string">Event Manager:: Let me talk to the folks</span></div><div class="line"><span class="string">Arranging the Hotel for Marriage? --</span></div><div class="line"><span class="string">Is the Hotel free for the event on given day?</span></div><div class="line"><span class="string">Registered the Booking</span></div><div class="line"><span class="string">Flower Decorations for the Event? --</span></div><div class="line"><span class="string">Carnations, Roses and Lilies would be used for Decorations</span></div><div class="line"><span class="string">Food Arrangements for the Event --</span></div><div class="line"><span class="string">Chinese &amp; Continental Cuisine to be served</span></div><div class="line"><span class="string">Musical Arrangements for the Marriage --</span></div><div class="line"><span class="string">Jazz and Classical will be played</span></div><div class="line"><span class="string">You:: Thanks to Event Manager, all preparations done!Phew!</span></div><div class="line"><span class="string">'''</span></div></pre></td></tr></table></figure>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>减少了系统的相互依赖。所有的依赖都是对门面对象的依赖，与子系统无关</li>
<li>提高灵活性，不管子系统内部如何变化，只要不影响到门面对象，任你自由活动</li>
<li>提高安全性</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>不符合开闭原则，对修改关闭，对扩展开放。唯一能做的就只有修改门面角色的代码。</li>
</ul>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul>
<li>为一个复杂的模块或子系统提供一个供外界访问的接口</li>
<li>子系统相对独立——外界对子系统的访问只要黑箱操作即可</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>一个子系统可以有多个门面</li>
<li>门面不参与子系统内的业务逻辑</li>
<li>门面只是提供一个访问子系统的一个路径，它不应该也不能参与具体的业务逻辑，否则会产生一个倒依赖的问题：子系统必须依赖门面才能被访问。</li>
<li>门面不能常变，而业务常变</li>
<li>解决方法，可以将具体的业务封装在一个类中，封装完毕后提供给门面对象调用。（试下修改代码中的arrange？）</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/850/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/850/" itemprop="url">Python设计模式——工厂方法模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T13:35:43+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h2><h3 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory1-800x555.png" alt=""><br></div><br>当Client调用Factory的create_type方法，Factory会根据传递的参数，生产出Product1或Product2</p>
<h2 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h2><p>定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p>
<p><em>define an interface to create objects, but instead of the factory being responsible for the object creation, the responsibility is deferred to the subclass that decides the class to be instantiated.</em></p>
<p>抽象产品类Product负责定义产品的共性，实现对事物最抽象的定义；<br>Creator为抽象创造类，也就是抽象工厂，具体如何创建产品类是由具体的实现工厂ConcreteCreator完成的。</p>
<h3 id="UML图-1"><a href="#UML图-1" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory2.png" alt=""><br></div></p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Section</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonalSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Personal Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlbumSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Album Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PatentSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Patent Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PublicationSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Publication Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.sections = []</div><div class="line">        self.createProfile()</div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getSections</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.sections</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addSections</span><span class="params">(self, section)</span>:</span></div><div class="line">        self.sections.append(section)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">linkedin</span><span class="params">(Profile)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        self.addSections(PersonalSection())</div><div class="line">        self.addSections(PatentSection())</div><div class="line">        self.addSections(PublicationSection())</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">facebook</span><span class="params">(Profile)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        self.addSections(PersonalSection())</div><div class="line">        self.addSections(AlbumSection())</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    profile_type = input(<span class="string">"Which Profile you'd like to create? [LinkedIn or FaceBook]\n"</span>)</div><div class="line">    profile = eval(profile_type.lower())()</div><div class="line">    print(<span class="string">"Creating Profile.."</span>, type(profile).__name__)</div><div class="line">    print(<span class="string">"Profile has sections --"</span>, profile.getSections())</div></pre></td></tr></table></figure>
<p>对比简单工厂模式，你就会发现，两者的不同在于工厂方法模式多了一个抽象工厂类（在此例中为Profile）。所以<strong>“定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。”</strong></p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>良好的封装性。一个对象创建时有条件约束的，如一个调用者需要一个具体的产品对象，只要知道这个产品的类名（或者约束字符串）就可以了。屏蔽了产品类。</li>
<li>扩展性优秀。只要扩展一个工厂类就行。</li>
<li>解耦</li>
</ol>
<p>工厂方法模式是new一个对象的代替品，但需要考虑其增加代码复杂度的成本。<br>例如设计一个连接邮件服务器的框架，把POP3，IMAP，HTTP三种连接方式作为产品类。<br>定义一个工厂方法，根据不同的传入条件，产生不同的产品类，从而选择不同的连接方式。</p>
<hr>
<h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><h3 id="UML图-2"><a href="#UML图-2" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory3-800x358.png" alt=""><br></div><br>Product1与Product2是由关联的，而其又分别从两个工厂生产出来的，用户通过使用抽象工厂的接口，指挥具体的工厂生产出产品</p>
<h3 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndianPizzaFactory</span><span class="params">(PizzaFactory)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> DeluxVeggiePizza()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> ChickenPizza()</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">USPizzaFactory</span><span class="params">(PizzaFactory)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> MexicanVegPizza()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> HamPizza()</div><div class="line"><span class="comment"># 素食披萨</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VegPizza</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="comment"># 非素食披萨</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonVegPizza</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeluxVeggiePizza</span><span class="params">(VegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Prepare "</span>, type(self).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChickenPizza</span><span class="params">(NonVegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        print(type(self).__name__, <span class="string">" is served with Chicken on "</span>, type(VegPizza).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MexicanVegPizza</span><span class="params">(VegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Prepare "</span>, type(self).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HamPizza</span><span class="params">(NonVegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        print(type(self).__name__, <span class="string">" is served with Ham on "</span>, type(VegPizza).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">makePizzas</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">for</span> factory <span class="keyword">in</span> [IndianPizzaFactory(), USPizzaFactory()]:</div><div class="line">            self.factory = factory</div><div class="line">            self.NonVegPizza = self.factory.createNonVegPizza()</div><div class="line">            self.VegPizza = self.factory.createVegPizza()</div><div class="line">            <span class="comment"># NonVegPizza 依赖于 VegPizza</span></div><div class="line">            self.VegPizza.prepare()</div><div class="line">            self.NonVegPizza.serve(self.VegPizza)</div><div class="line">pizza = PizzaStore()</div><div class="line">pizza.makePizzas()</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">Prepare DeluxVeggiePizza</span></div><div class="line"><span class="string">ChickenPizza is served with Chicken on DeluxVeggiePizza</span></div><div class="line"><span class="string">Prepare MexicanVegPizza</span></div><div class="line"><span class="string">HamPizza is served with Ham on MexicanVegPizza</span></div><div class="line"><span class="string">'''</span></div></pre></td></tr></table></figure>
<h2 id="工厂方法和抽象工厂方法的不同"><a href="#工厂方法和抽象工厂方法的不同" class="headerlink" title="工厂方法和抽象工厂方法的不同"></a>工厂方法和抽象工厂方法的不同</h2><table>
<thead>
<tr>
<th>工厂方法</th>
<th>抽象工厂方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>把创造产品的方法暴露给客户</td>
<td>包含一个或多个工厂方法，来创造有关联的产品</td>
</tr>
<tr>
<td>子类决定实例化哪一个类</td>
<td>使用合成来委托</td>
</tr>
<tr>
<td>工厂方法用来创建一个对象</td>
<td>创造一个有关联的产品族</td>
</tr>
</tbody>
</table>
<p>抽象工厂方法，增加产品族非常难。这要更改AbstractCreator，增加一个createProduct，然后其余的createProduct都要一同更改。<br>但是增加产品还是很方便的，比如我们增加一个海鲜披萨？<br>但涉及跨平台的时候，各个操作系统上的软件功能，应用逻辑，UI都大致相似，我们需要的是使用抽象工厂模式屏蔽掉操作系统对应用的影响，调用不同的工厂方法，由不同的产品类去处理与操作系统交互的信息。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/18/target/850/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/target/850/" itemprop="url">Python设计模式——工厂方法模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T13:35:43+08:00">2016-10-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h2><h3 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory1-800x555.png" alt=""><br></div><br>当Client调用Factory的create_type方法，Factory会根据传递的参数，生产出Product1或Product2</p>
<h2 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h2><p>定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p>
<p><em>define an interface to create objects, but instead of the factory being responsible for the object creation, the responsibility is deferred to the subclass that decides the class to be instantiated.</em></p>
<p>抽象产品类Product负责定义产品的共性，实现对事物最抽象的定义；<br>Creator为抽象创造类，也就是抽象工厂，具体如何创建产品类是由具体的实现工厂ConcreteCreator完成的。</p>
<h3 id="UML图-1"><a href="#UML图-1" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory2.png" alt=""><br></div></p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Section</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonalSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Personal Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlbumSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Album Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PatentSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Patent Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PublicationSection</span><span class="params">(Section)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Publication Section"</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.sections = []</div><div class="line">        self.createProfile()</div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getSections</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.sections</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addSections</span><span class="params">(self, section)</span>:</span></div><div class="line">        self.sections.append(section)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">linkedin</span><span class="params">(Profile)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        self.addSections(PersonalSection())</div><div class="line">        self.addSections(PatentSection())</div><div class="line">        self.addSections(PublicationSection())</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">facebook</span><span class="params">(Profile)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createProfile</span><span class="params">(self)</span>:</span></div><div class="line">        self.addSections(PersonalSection())</div><div class="line">        self.addSections(AlbumSection())</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    profile_type = input(<span class="string">"Which Profile you'd like to create? [LinkedIn or FaceBook]\n"</span>)</div><div class="line">    profile = eval(profile_type.lower())()</div><div class="line">    print(<span class="string">"Creating Profile.."</span>, type(profile).__name__)</div><div class="line">    print(<span class="string">"Profile has sections --"</span>, profile.getSections())</div></pre></td></tr></table></figure>
<p>对比简单工厂模式，你就会发现，两者的不同在于工厂方法模式多了一个抽象工厂类（在此例中为Profile）。所以<strong>“定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。”</strong></p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>良好的封装性。一个对象创建时有条件约束的，如一个调用者需要一个具体的产品对象，只要知道这个产品的类名（或者约束字符串）就可以了。屏蔽了产品类。</li>
<li>扩展性优秀。只要扩展一个工厂类就行。</li>
<li>解耦</li>
</ol>
<p>工厂方法模式是new一个对象的代替品，但需要考虑其增加代码复杂度的成本。<br>例如设计一个连接邮件服务器的框架，把POP3，IMAP，HTTP三种连接方式作为产品类。<br>定义一个工厂方法，根据不同的传入条件，产生不同的产品类，从而选择不同的连接方式。</p>
<hr>
<h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><h3 id="UML图-2"><a href="#UML图-2" class="headerlink" title="UML图"></a>UML图</h3><p><div align="center"><br><img src="./factory3-800x358.png" alt=""><br></div><br>Product1与Product2是由关联的，而其又分别从两个工厂生产出来的，用户通过使用抽象工厂的接口，指挥具体的工厂生产出产品</p>
<h3 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndianPizzaFactory</span><span class="params">(PizzaFactory)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> DeluxVeggiePizza()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> ChickenPizza()</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">USPizzaFactory</span><span class="params">(PizzaFactory)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> MexicanVegPizza()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createNonVegPizza</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> HamPizza()</div><div class="line"><span class="comment"># 素食披萨</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VegPizza</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="comment"># 非素食披萨</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonVegPizza</span><span class="params">(metaclass=ABCMeta)</span>:</span></div><div class="line"><span class="meta">    @abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeluxVeggiePizza</span><span class="params">(VegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Prepare "</span>, type(self).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChickenPizza</span><span class="params">(NonVegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        print(type(self).__name__, <span class="string">" is served with Chicken on "</span>, type(VegPizza).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MexicanVegPizza</span><span class="params">(VegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"Prepare "</span>, type(self).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HamPizza</span><span class="params">(NonVegPizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, VegPizza)</span>:</span></div><div class="line">        print(type(self).__name__, <span class="string">" is served with Ham on "</span>, type(VegPizza).__name__)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">makePizzas</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">for</span> factory <span class="keyword">in</span> [IndianPizzaFactory(), USPizzaFactory()]:</div><div class="line">            self.factory = factory</div><div class="line">            self.NonVegPizza = self.factory.createNonVegPizza()</div><div class="line">            self.VegPizza = self.factory.createVegPizza()</div><div class="line">            <span class="comment"># NonVegPizza 依赖于 VegPizza</span></div><div class="line">            self.VegPizza.prepare()</div><div class="line">            self.NonVegPizza.serve(self.VegPizza)</div><div class="line">pizza = PizzaStore()</div><div class="line">pizza.makePizzas()</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">Prepare DeluxVeggiePizza</span></div><div class="line"><span class="string">ChickenPizza is served with Chicken on DeluxVeggiePizza</span></div><div class="line"><span class="string">Prepare MexicanVegPizza</span></div><div class="line"><span class="string">HamPizza is served with Ham on MexicanVegPizza</span></div><div class="line"><span class="string">'''</span></div></pre></td></tr></table></figure>
<h2 id="工厂方法和抽象工厂方法的不同"><a href="#工厂方法和抽象工厂方法的不同" class="headerlink" title="工厂方法和抽象工厂方法的不同"></a>工厂方法和抽象工厂方法的不同</h2><table>
<thead>
<tr>
<th>工厂方法</th>
<th>抽象工厂方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>把创造产品的方法暴露给客户</td>
<td>包含一个或多个工厂方法，来创造有关联的产品</td>
</tr>
<tr>
<td>子类决定实例化哪一个类</td>
<td>使用合成来委托</td>
</tr>
<tr>
<td>工厂方法用来创建一个对象</td>
<td>创造一个有关联的产品族</td>
</tr>
</tbody>
</table>
<p>抽象工厂方法，增加产品族非常难。这要更改AbstractCreator，增加一个createProduct，然后其余的createProduct都要一同更改。<br>但是增加产品还是很方便的，比如我们增加一个海鲜披萨？<br>但涉及跨平台的时候，各个操作系统上的软件功能，应用逻辑，UI都大致相似，我们需要的是使用抽象工厂模式屏蔽掉操作系统对应用的影响，调用不同的工厂方法，由不同的产品类去处理与操作系统交互的信息。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/17/844/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/17/844/" itemprop="url">每天一道编程题——换零钱的方法数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-17T21:18:20+08:00">2016-10-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>给定数组arr，arr中所有的值都为正数且不重复。每个值代表一种面值的货币，每种面值的货币可以使用任意张，在给定一个整数aim代表要找的钱，求换钱有多少种方法。<br>如<br>arr=[1,5,10,25],aim=0,返回1<br>arr=[1,5,10,25],aim=15,返回6<br>arr=[3,5],aim=2,返回0</p>
<h3 id="暴力递归破解法"><a href="#暴力递归破解法" class="headerlink" title="暴力递归破解法"></a>暴力递归破解法</h3><p>如果arr=[5,10,25,1],aim=15<br>1.用0张5元货币，让[10,25,1]组成剩下的15,最终方法数记为res1<br>2.用1张5元货币，让[10,25,1]组成剩下的10,最终方法数记为res2<br>3.用2张5元货币，让[10,25,1]组成剩下的5,最终方法数记为res3<br>4.用3张5元货币，让[10,25,1]组成剩下的0,最终方法数记为res4<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">res1:2(0*5+15*1;0*5+1*10+1*5)</div><div class="line">res2:2(1*5+10*1;1*5+1*10)</div><div class="line">res3:1(2*5+5*1)</div><div class="line">res4:1(3*5)</div></pre></td></tr></table></figure></p>
<p>答案就是res1+res2+res3+res4<br>缺点：<br>大量重复计算。<br>规模小的时候还好，一旦规模大了。<br>比如aim=1000，对于0<em>5+1</em>10和2<em>5+0</em>10，后续的计算都是一样的，求[25,1]组合剩下的990的方法总数。</p>
<h4 id="复杂度："><a href="#复杂度：" class="headerlink" title="复杂度："></a>复杂度：</h4><p>O(aim^N)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">arr = [<span class="number">5</span>, <span class="number">10</span>, <span class="number">25</span>, <span class="number">1</span>]</div><div class="line">aim = <span class="number">15</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_res_conis</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">r</span><span class="params">(arr, aim, index)</span>:</span></div><div class="line">        res = <span class="number">0</span></div><div class="line">        <span class="keyword">if</span> index == len(arr):</div><div class="line">            res = <span class="number">1</span> <span class="keyword">if</span> aim == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            i = <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[index] * i &lt;= aim:</div><div class="line">                res += r(arr, aim - arr[index] * i, index + <span class="number">1</span>)</div><div class="line">                i += <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> r(arr, aim, <span class="number">0</span>)</div></pre></td></tr></table></figure>
<h3 id="经过记忆搜索优化的暴力递归"><a href="#经过记忆搜索优化的暴力递归" class="headerlink" title="经过记忆搜索优化的暴力递归"></a>经过记忆搜索优化的暴力递归</h3><p>又如上面aim=1000的例子。<br>对于0*5+1*10和2*5+0*10，他们调用递归函数时候传入的参数，arr,aim,index都是相同的，也就是说我们可以利用这一性质去除重复的计算。<br>记忆搜索优化是针对暴力递归最初级的优化技巧，分析递归函数的状态可以由那些变量表示，做出相应维度和大小的cache即可。</p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度:"></a>复杂度:</h4><p>O(N*aim^2)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo</span><span class="params">(func)</span>:</span></div><div class="line">    cache = &#123;&#125;</div><div class="line"><span class="meta">    @wraps(func)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(*args)</span>:</span></div><div class="line">        <span class="keyword">if</span> args <span class="keyword">not</span> <span class="keyword">in</span> cache:</div><div class="line">            cache[args] = func(*args)</div><div class="line">        <span class="keyword">return</span> cache[args]</div><div class="line">    <span class="keyword">return</span> wrap</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo_res_conis</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    arr = arr</div><div class="line"><span class="meta">    @memo</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">r</span><span class="params">(aim, index)</span>:</span></div><div class="line">        res = <span class="number">0</span></div><div class="line">        <span class="keyword">if</span> index == len(arr):</div><div class="line">            res = <span class="number">1</span> <span class="keyword">if</span> aim == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            i = <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[index] * i &lt;= aim:</div><div class="line">                res += r(aim - arr[index] * i, index + <span class="number">1</span>)</div><div class="line">                i += <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> r(aim, <span class="number">0</span>)</div><div class="line"><span class="comment"># ++++++++++++++++++++TEST++++++++++++++++++++++++++</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">import time</span></div><div class="line"><span class="string">aim=500</span></div><div class="line"><span class="string">begin=time.time()</span></div><div class="line"><span class="string">print memo_res(arr,aim)</span></div><div class="line"><span class="string">print time.time()-begin</span></div><div class="line"><span class="string">begin=time.time()</span></div><div class="line"><span class="string">print naive_res(arr,aim)</span></div><div class="line"><span class="string">print time.time()-begin</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="comment"># 结果</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">19006</span></div><div class="line"><span class="string">0.018000125885</span></div><div class="line"><span class="string">19006</span></div><div class="line"><span class="string">1.15899991989</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="comment"># ++++++++++++++++++++TEST END+++++++++++++++++++++++</span></div></pre></td></tr></table></figure>
<p>关于记忆搜索优化，可见<a href="http://blog.vincentzhong.cn/index.php/archives/498" target="_blank" rel="external">记忆体化的装饰器</a>。</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">dp[i][j]的含义，在可以任意使用arr[0...i]货币的情况下，组成j有多少种方法。</div><div class="line">dp[...][0]:组成钱为0的方法数，全部置1</div><div class="line">dp[0][...]:只能使用arr[0]的货币的情况下，组成钱的方法数</div><div class="line">dp[1][...]:只能使用arr[0]与arr[1]的货币的情况下，组成钱的方法数</div><div class="line">假设计算到位置(i,j),dp[i][j]的值可能来自下面的情况</div><div class="line">1.完全不使用当前货币arr[i]的情况,即dp[i-1][j]</div><div class="line">2.使用1张货币arr[i]的情况,即dp[i-1][j-arr[i]]</div><div class="line">3.使用2张货币arr[i]的情况,即dp[i-1][j-2*arr[i]]</div><div class="line">....</div><div class="line">k+1.使用k张货币arr[i]的情况,即dp[i-1][j-k*arr[i]] (j-k*arr[i]&gt;=0)</div><div class="line">#### 复杂度：</div><div class="line">枚举dp[i-1][0...j]上的所有值，dp一共有N*aim个</div><div class="line">O(N*aim^2)</div><div class="line">本质上，动态规划等价于记忆化搜索方法。</div><div class="line">记忆话搜索的方法说白了就是不关心到达某一个递归过程的路径，只是单纯地对计算过的递归过程进行记录，避免重复的递归。</div><div class="line">动态规划的方法则是规定好每一个递归过程的计算顺序，一次进行计算，后计算的过程严格依赖前面计算的过程。</div><div class="line">动态规划规定计算顺序，而记忆搜索不用规定。</div><div class="line">各有各的优势</div><div class="line">动态规划可以将递归变为迭代。</div><div class="line">记忆搜索面对某些情况，如arr=[20000,10000,1000],aim=2000000000的情况有优势</div></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coins</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [[<span class="number">0</span>] * (aim + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</div><div class="line">    <span class="comment"># 第一列全部置1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span></div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[<span class="number">0</span>][arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            num, k = <span class="number">0</span>, <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[i] * k &lt;= j:</div><div class="line">                <span class="comment"># k=0时,也就是dp[i-1][j],也就是上一个元素</span></div><div class="line">                <span class="comment"># k=1时,也就是使用一张arr[i]货币的情况</span></div><div class="line">                num += dp[i - <span class="number">1</span>][j - arr[i] * k]</div><div class="line">                k += <span class="number">1</span></div><div class="line">            dp[i][j] = num</div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>][<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h3 id="动态规划的优化（什么？还能优化？）"><a href="#动态规划的优化（什么？还能优化？）" class="headerlink" title="动态规划的优化（什么？还能优化？）"></a>动态规划的优化（什么？还能优化？）</h3><p>我们将目光放在前一个算法的第二个while循环里面。<br>本质上，while里面的枚举可以化简为dp[i][j]=dp[i-1][j]+dp[i][[j-arr[i]] (上边的加上左边的)<br>如，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = [5, 10, 25, 1]</div><div class="line">aim = 25</div><div class="line">dp[1][25]=dp[0][25](只用5块)+dp[i][[j-arr[i]](用5块跟10块组成j-arr[i]元的方法数)</div></pre></td></tr></table></figure></p>
<h4 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度:"></a>复杂度:</h4><p>O(N*aim)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coin2</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [[<span class="number">0</span>] * (aim + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</div><div class="line">    <span class="comment"># 第一列全部置1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span></div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[<span class="number">0</span>][arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            dp[i][j] = dp[i - <span class="number">1</span>][j]</div><div class="line">            dp[i][j] += dp[i][j - arr[i]] <span class="keyword">if</span> j - arr[i] &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>][<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h3 id="空间压缩"><a href="#空间压缩" class="headerlink" title="空间压缩"></a>空间压缩</h3><p>将空间复杂度降为O(aim)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coin3</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(aim + <span class="number">1</span>)]</div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            dp[j] += dp[j - arr[i]] <span class="keyword">if</span> j - arr[i] &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>]</div><div class="line"><span class="keyword">print</span> dp_coin3(arr, aim)</div></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/17/target/844/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/17/target/844/" itemprop="url">每天一道编程题——换零钱的方法数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-17T21:18:20+08:00">2016-10-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>给定数组arr，arr中所有的值都为正数且不重复。每个值代表一种面值的货币，每种面值的货币可以使用任意张，在给定一个整数aim代表要找的钱，求换钱有多少种方法。<br>如<br>arr=[1,5,10,25],aim=0,返回1<br>arr=[1,5,10,25],aim=15,返回6<br>arr=[3,5],aim=2,返回0</p>
<h3 id="暴力递归破解法"><a href="#暴力递归破解法" class="headerlink" title="暴力递归破解法"></a>暴力递归破解法</h3><p>如果arr=[5,10,25,1],aim=15<br>1.用0张5元货币，让[10,25,1]组成剩下的15,最终方法数记为res1<br>2.用1张5元货币，让[10,25,1]组成剩下的10,最终方法数记为res2<br>3.用2张5元货币，让[10,25,1]组成剩下的5,最终方法数记为res3<br>4.用3张5元货币，让[10,25,1]组成剩下的0,最终方法数记为res4<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">res1:2(0*5+15*1;0*5+1*10+1*5)</div><div class="line">res2:2(1*5+10*1;1*5+1*10)</div><div class="line">res3:1(2*5+5*1)</div><div class="line">res4:1(3*5)</div></pre></td></tr></table></figure></p>
<p>答案就是res1+res2+res3+res4<br>缺点：<br>大量重复计算。<br>规模小的时候还好，一旦规模大了。<br>比如aim=1000，对于0<em>5+1</em>10和2<em>5+0</em>10，后续的计算都是一样的，求[25,1]组合剩下的990的方法总数。</p>
<h4 id="复杂度："><a href="#复杂度：" class="headerlink" title="复杂度："></a>复杂度：</h4><p>O(aim^N)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">arr = [<span class="number">5</span>, <span class="number">10</span>, <span class="number">25</span>, <span class="number">1</span>]</div><div class="line">aim = <span class="number">15</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_res_conis</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">r</span><span class="params">(arr, aim, index)</span>:</span></div><div class="line">        res = <span class="number">0</span></div><div class="line">        <span class="keyword">if</span> index == len(arr):</div><div class="line">            res = <span class="number">1</span> <span class="keyword">if</span> aim == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            i = <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[index] * i &lt;= aim:</div><div class="line">                res += r(arr, aim - arr[index] * i, index + <span class="number">1</span>)</div><div class="line">                i += <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> r(arr, aim, <span class="number">0</span>)</div></pre></td></tr></table></figure>
<h3 id="经过记忆搜索优化的暴力递归"><a href="#经过记忆搜索优化的暴力递归" class="headerlink" title="经过记忆搜索优化的暴力递归"></a>经过记忆搜索优化的暴力递归</h3><p>又如上面aim=1000的例子。<br>对于0*5+1*10和2*5+0*10，他们调用递归函数时候传入的参数，arr,aim,index都是相同的，也就是说我们可以利用这一性质去除重复的计算。<br>记忆搜索优化是针对暴力递归最初级的优化技巧，分析递归函数的状态可以由那些变量表示，做出相应维度和大小的cache即可。</p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度:"></a>复杂度:</h4><p>O(N*aim^2)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo</span><span class="params">(func)</span>:</span></div><div class="line">    cache = &#123;&#125;</div><div class="line"><span class="meta">    @wraps(func)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(*args)</span>:</span></div><div class="line">        <span class="keyword">if</span> args <span class="keyword">not</span> <span class="keyword">in</span> cache:</div><div class="line">            cache[args] = func(*args)</div><div class="line">        <span class="keyword">return</span> cache[args]</div><div class="line">    <span class="keyword">return</span> wrap</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo_res_conis</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    arr = arr</div><div class="line"><span class="meta">    @memo</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">r</span><span class="params">(aim, index)</span>:</span></div><div class="line">        res = <span class="number">0</span></div><div class="line">        <span class="keyword">if</span> index == len(arr):</div><div class="line">            res = <span class="number">1</span> <span class="keyword">if</span> aim == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            i = <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[index] * i &lt;= aim:</div><div class="line">                res += r(aim - arr[index] * i, index + <span class="number">1</span>)</div><div class="line">                i += <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> r(aim, <span class="number">0</span>)</div><div class="line"><span class="comment"># ++++++++++++++++++++TEST++++++++++++++++++++++++++</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">import time</span></div><div class="line"><span class="string">aim=500</span></div><div class="line"><span class="string">begin=time.time()</span></div><div class="line"><span class="string">print memo_res(arr,aim)</span></div><div class="line"><span class="string">print time.time()-begin</span></div><div class="line"><span class="string">begin=time.time()</span></div><div class="line"><span class="string">print naive_res(arr,aim)</span></div><div class="line"><span class="string">print time.time()-begin</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="comment"># 结果</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">19006</span></div><div class="line"><span class="string">0.018000125885</span></div><div class="line"><span class="string">19006</span></div><div class="line"><span class="string">1.15899991989</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="comment"># ++++++++++++++++++++TEST END+++++++++++++++++++++++</span></div></pre></td></tr></table></figure>
<p>关于记忆搜索优化，可见<a href="http://blog.vincentzhong.cn/index.php/archives/498" target="_blank" rel="external">记忆体化的装饰器</a>。</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">dp[i][j]的含义，在可以任意使用arr[0...i]货币的情况下，组成j有多少种方法。</div><div class="line">dp[...][0]:组成钱为0的方法数，全部置1</div><div class="line">dp[0][...]:只能使用arr[0]的货币的情况下，组成钱的方法数</div><div class="line">dp[1][...]:只能使用arr[0]与arr[1]的货币的情况下，组成钱的方法数</div><div class="line">假设计算到位置(i,j),dp[i][j]的值可能来自下面的情况</div><div class="line">1.完全不使用当前货币arr[i]的情况,即dp[i-1][j]</div><div class="line">2.使用1张货币arr[i]的情况,即dp[i-1][j-arr[i]]</div><div class="line">3.使用2张货币arr[i]的情况,即dp[i-1][j-2*arr[i]]</div><div class="line">....</div><div class="line">k+1.使用k张货币arr[i]的情况,即dp[i-1][j-k*arr[i]] (j-k*arr[i]&gt;=0)</div><div class="line">#### 复杂度：</div><div class="line">枚举dp[i-1][0...j]上的所有值，dp一共有N*aim个</div><div class="line">O(N*aim^2)</div><div class="line">本质上，动态规划等价于记忆化搜索方法。</div><div class="line">记忆话搜索的方法说白了就是不关心到达某一个递归过程的路径，只是单纯地对计算过的递归过程进行记录，避免重复的递归。</div><div class="line">动态规划的方法则是规定好每一个递归过程的计算顺序，一次进行计算，后计算的过程严格依赖前面计算的过程。</div><div class="line">动态规划规定计算顺序，而记忆搜索不用规定。</div><div class="line">各有各的优势</div><div class="line">动态规划可以将递归变为迭代。</div><div class="line">记忆搜索面对某些情况，如arr=[20000,10000,1000],aim=2000000000的情况有优势</div></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coins</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [[<span class="number">0</span>] * (aim + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</div><div class="line">    <span class="comment"># 第一列全部置1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span></div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[<span class="number">0</span>][arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            num, k = <span class="number">0</span>, <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> arr[i] * k &lt;= j:</div><div class="line">                <span class="comment"># k=0时,也就是dp[i-1][j],也就是上一个元素</span></div><div class="line">                <span class="comment"># k=1时,也就是使用一张arr[i]货币的情况</span></div><div class="line">                num += dp[i - <span class="number">1</span>][j - arr[i] * k]</div><div class="line">                k += <span class="number">1</span></div><div class="line">            dp[i][j] = num</div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>][<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h3 id="动态规划的优化（什么？还能优化？）"><a href="#动态规划的优化（什么？还能优化？）" class="headerlink" title="动态规划的优化（什么？还能优化？）"></a>动态规划的优化（什么？还能优化？）</h3><p>我们将目光放在前一个算法的第二个while循环里面。<br>本质上，while里面的枚举可以化简为dp[i][j]=dp[i-1][j]+dp[i][[j-arr[i]] (上边的加上左边的)<br>如，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = [5, 10, 25, 1]</div><div class="line">aim = 25</div><div class="line">dp[1][25]=dp[0][25](只用5块)+dp[i][[j-arr[i]](用5块跟10块组成j-arr[i]元的方法数)</div></pre></td></tr></table></figure></p>
<h4 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度:"></a>复杂度:</h4><p>O(N*aim)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coin2</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [[<span class="number">0</span>] * (aim + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</div><div class="line">    <span class="comment"># 第一列全部置1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span></div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[<span class="number">0</span>][arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            dp[i][j] = dp[i - <span class="number">1</span>][j]</div><div class="line">            dp[i][j] += dp[i][j - arr[i]] <span class="keyword">if</span> j - arr[i] &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>][<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h3 id="空间压缩"><a href="#空间压缩" class="headerlink" title="空间压缩"></a>空间压缩</h3><p>将空间复杂度降为O(aim)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp_coin3</span><span class="params">(arr, aim)</span>:</span></div><div class="line">    n = len(arr)</div><div class="line">    dp = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(aim + <span class="number">1</span>)]</div><div class="line">    <span class="comment"># 初始化第一行</span></div><div class="line">    j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> arr[<span class="number">0</span>] * j &lt;= aim:</div><div class="line">        dp[arr[<span class="number">0</span>] * j] = <span class="number">1</span></div><div class="line">        j += <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, aim + <span class="number">1</span>):</div><div class="line">            dp[j] += dp[j - arr[i]] <span class="keyword">if</span> j - arr[i] &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> dp[<span class="number">-1</span>]</div><div class="line"><span class="keyword">print</span> dp_coin3(arr, aim)</div></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/14/841/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/14/841/" itemprop="url">用Python撸DSL(领域特定语言)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-14T20:01:26+08:00">2016-10-14</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="何为DSL："><a href="#何为DSL：" class="headerlink" title="何为DSL："></a>何为DSL：</h3><p>DSL就是一种特定解决领域问题的的迷你语言。如SQL语言，正则表达式</p>
<h3 id="内部与外部"><a href="#内部与外部" class="headerlink" title="内部与外部"></a>内部与外部</h3><p>指的是实现DSL的方式是否与宿主语言隔离。</p>
<p><strong>内部DSL(Internal DSL)</strong><br>所谓内部DSL，就是用一种提供语言扩展功能的宿主语言来扩充的。<br>如Django中的Model</p>
<p><strong>外部DSL(External DSL)</strong><br>外部DSL则与源语言无关，重头写词法分析器、语法分析器以及解释执行器。</p>
<h3 id="为何要编写DSL"><a href="#为何要编写DSL" class="headerlink" title="为何要编写DSL"></a>为何要编写DSL</h3><p>举个例子，一个HTML表格<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Name:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”name”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”email”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”password”</span> <span class="attr">name</span>=<span class="string">”name”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编写这个HTML文档需要编写者具有HTML的知识<br>我们尝试着编写自己的DSL，将语句简化为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">UserForm</div><div class="line">username:CharField -&gt; label:Username size:25;</div><div class="line">email:EmailField -&gt; size:32;</div><div class="line">password:PasswordField;</div></pre></td></tr></table></figure></p>
<p>下面我们使用pyparsing库，来制作一款属于自己的DSL语言</p>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pyparsing <span class="keyword">import</span> Word, OneOrMore, Group, Suppress, alphanums, oneOf, alphas, Optional, lineEnd</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_prop_to_dict</span><span class="params">(tokens)</span>:</span></div><div class="line">    prop_dict = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> tokens:</div><div class="line">        prop_dict[token[<span class="number">0</span>]] = token[<span class="number">1</span>]</div><div class="line">    <span class="keyword">return</span> prop_dict</div><div class="line"><span class="comment"># Suppress 表示不捕获</span></div><div class="line">newline = Suppress(lineEnd)</div><div class="line">colon = Suppress(<span class="string">":"</span>)</div><div class="line">arrow = Suppress(<span class="string">"-&gt;"</span>)</div><div class="line">semicolon = Suppress(<span class="string">";"</span>)</div><div class="line">word = Word(alphas)</div><div class="line">key = word</div><div class="line">value = Word(alphanums)</div><div class="line">field_type = oneOf(<span class="string">"CharField EmailField PasswordField"</span>)</div><div class="line">field_name = word</div><div class="line">form_name = word.setResultsName(<span class="string">"form_name"</span>)</div><div class="line">field_property = Group(key + colon + value)</div><div class="line">field = Group(field_name + colon + field_type + Optional(arrow + OneOrMore(field_property) + semicolon).setParseAction(</div><div class="line">        convert_prop_to_dict))</div><div class="line">form = form_name + newline + OneOrMore(field).setResultsName(<span class="string">"form_field"</span>)</div><div class="line">input_form = <span class="string">'''</span></div><div class="line"><span class="string">UserForm</span></div><div class="line"><span class="string">username:CharField -&gt; label:Username size:25;</span></div><div class="line"><span class="string">email:EmailField -&gt; size:32;</span></div><div class="line"><span class="string">password:PasswordField;</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">External DSL</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_field_html</span><span class="params">(field)</span>:</span></div><div class="line">    properties = field[<span class="number">2</span>]</div><div class="line">    label = properties[<span class="string">"label"</span>] <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> properties <span class="keyword">else</span> field[<span class="number">0</span>]</div><div class="line">    label_html = <span class="string">"&lt;label&gt;"</span> + label + <span class="string">"&lt;/label&gt;"</span></div><div class="line">    attributes = &#123;<span class="string">"name"</span>: field[<span class="number">0</span>]&#125;</div><div class="line">    attributes.update(properties)</div><div class="line">    <span class="keyword">if</span> field[<span class="number">1</span>] == <span class="string">"CharField"</span> <span class="keyword">or</span> field[<span class="number">1</span>] == <span class="string">"EmailField"</span>:</div><div class="line">        attributes[<span class="string">"type"</span>] = <span class="string">"text"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        attributes[<span class="string">"type"</span>] = <span class="string">"password"</span></div><div class="line">    <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> attributes:</div><div class="line">        <span class="keyword">del</span> attributes[<span class="string">"label"</span>]</div><div class="line">    attributes_html = <span class="string">" "</span>.join([name + <span class="string">"='"</span> + value + <span class="string">"'"</span> <span class="keyword">for</span> name, value <span class="keyword">in</span> attributes.items()])</div><div class="line">    field_html = <span class="string">"&lt;input "</span> + attributes_html + <span class="string">"/&gt;"</span></div><div class="line">    <span class="keyword">return</span> label_html + field_html + <span class="string">"&lt;br/&gt;"</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(form)</span>:</span></div><div class="line">    fields_html = <span class="string">""</span>.join([get_field_html(field) <span class="keyword">for</span> field <span class="keyword">in</span> form.form_field])</div><div class="line">    <span class="keyword">return</span> <span class="string">"&lt;form id='"</span> + form.form_name.lower() + <span class="string">"'&gt;"</span> + fields_html + <span class="string">"&lt;/form&gt;"</span></div><div class="line">print(render(form.parseString(input_form)))</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">Internal DSL</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlElement</span><span class="params">(object)</span>:</span></div><div class="line">    default_attributes = &#123;&#125;</div><div class="line">    tag = <span class="string">"unknown_tag"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        self.attributes = kwargs</div><div class="line">        self.attributes.update(self.default_attributes)</div><div class="line">        self.children = args</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        attribute_html = <span class="string">" "</span>.join([<span class="string">"&#123;&#125;='&#123;&#125;'"</span>.format(name, value)</div><div class="line">                                   <span class="keyword">for</span> name, value <span class="keyword">in</span> self.attributes.items()])</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.children:</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;&#125; &#123;&#125;/&gt;"</span>.format(self.tag, attribute_html)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            children_html = <span class="string">""</span>.join([str(child) <span class="keyword">for</span> child <span class="keyword">in</span> self.children])</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;&#125; &#123;&#125;&gt;&#123;&#125;&lt;/&#123;&#125;&gt;"</span>.format(self.tag, attribute_html, children_html, self.tag)</div><div class="line"><span class="comment"># print(HtmlElement(id="test"))</span></div><div class="line"><span class="comment"># &lt;unknown_tag id='test'/&gt;</span></div><div class="line"><span class="comment"># print (HtmlElement(HtmlElement(name="test"), id="id"))</span></div><div class="line"><span class="comment"># &lt;unknown_tag id='id'&gt;&lt;unknown_tag name='test'/&gt;&lt;/unknown_tag&gt;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputElement</span><span class="params">(HtmlElement)</span>:</span></div><div class="line">    tag = <span class="string">"input"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        HtmlElement.__init__(self, *args, **kwargs)</div><div class="line">        self.label = self.attributes[<span class="string">"label"</span>] <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> self.attributes <span class="keyword">else</span> self.attributes[<span class="string">"name"</span>]</div><div class="line">        <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> self.attributes:</div><div class="line">            <span class="keyword">del</span> self.attributes[<span class="string">"label"</span>]</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        label_html = <span class="string">"&lt;label&gt;&#123;&#125;&lt;/label&gt;"</span>.format(self.label)</div><div class="line">        <span class="keyword">return</span> label_html + HtmlElement.__str__(self) + <span class="string">"&lt;br/&gt;"</span></div><div class="line"><span class="comment"># print(InputElement(name="username"))</span></div><div class="line"><span class="comment"># &lt;label&gt;username&lt;/label&gt;&lt;input name='username'/&gt;&lt;br/&gt;</span></div><div class="line"><span class="comment"># print(InputElement(name="username", label="User ID"))</span></div><div class="line"><span class="comment"># &lt;label&gt;User ID&lt;/label&gt;&lt;input name='username'/&gt;&lt;br/&gt;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Form</span><span class="params">(HtmlElement)</span>:</span></div><div class="line">    tag = <span class="string">"form"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharField</span><span class="params">(InputElement)</span>:</span></div><div class="line">    default_attributes = &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailField</span><span class="params">(CharField)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordField</span><span class="params">(InputElement)</span>:</span></div><div class="line">    default_attributes = &#123;<span class="string">"type"</span>: <span class="string">"password"</span>&#125;</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(form)</span>:</span></div><div class="line">    field_dict = &#123;<span class="string">"CharField"</span>: CharField, <span class="string">"EmailField"</span>:</div><div class="line">        EmailField, <span class="string">"PasswordField"</span>: PasswordField&#125;</div><div class="line">    fields = [field_dict[field[<span class="number">1</span>]](name=field[<span class="number">0</span>], **field[<span class="number">2</span>]) <span class="keyword">for</span> field <span class="keyword">in</span> form.form_field]</div><div class="line">    <span class="keyword">return</span> Form(*fields, id=form.form_name.lower())</div><div class="line">print(render(form.parseString(input_form)))</div></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wax8280.github.io/2016/10/14/target/841/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/14/target/841/" itemprop="url">用Python撸DSL(领域特定语言)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-14T20:01:26+08:00">2016-10-14</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="何为DSL："><a href="#何为DSL：" class="headerlink" title="何为DSL："></a>何为DSL：</h3><p>DSL就是一种特定解决领域问题的的迷你语言。如SQL语言，正则表达式</p>
<h3 id="内部与外部"><a href="#内部与外部" class="headerlink" title="内部与外部"></a>内部与外部</h3><p>指的是实现DSL的方式是否与宿主语言隔离。</p>
<p><strong>内部DSL(Internal DSL)</strong><br>所谓内部DSL，就是用一种提供语言扩展功能的宿主语言来扩充的。<br>如Django中的Model</p>
<p><strong>外部DSL(External DSL)</strong><br>外部DSL则与源语言无关，重头写词法分析器、语法分析器以及解释执行器。</p>
<h3 id="为何要编写DSL"><a href="#为何要编写DSL" class="headerlink" title="为何要编写DSL"></a>为何要编写DSL</h3><p>举个例子，一个HTML表格<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Name:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”name”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”email”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”password”</span> <span class="attr">name</span>=<span class="string">”name”/</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编写这个HTML文档需要编写者具有HTML的知识<br>我们尝试着编写自己的DSL，将语句简化为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">UserForm</div><div class="line">username:CharField -&gt; label:Username size:25;</div><div class="line">email:EmailField -&gt; size:32;</div><div class="line">password:PasswordField;</div></pre></td></tr></table></figure></p>
<p>下面我们使用pyparsing库，来制作一款属于自己的DSL语言</p>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pyparsing <span class="keyword">import</span> Word, OneOrMore, Group, Suppress, alphanums, oneOf, alphas, Optional, lineEnd</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_prop_to_dict</span><span class="params">(tokens)</span>:</span></div><div class="line">    prop_dict = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> tokens:</div><div class="line">        prop_dict[token[<span class="number">0</span>]] = token[<span class="number">1</span>]</div><div class="line">    <span class="keyword">return</span> prop_dict</div><div class="line"><span class="comment"># Suppress 表示不捕获</span></div><div class="line">newline = Suppress(lineEnd)</div><div class="line">colon = Suppress(<span class="string">":"</span>)</div><div class="line">arrow = Suppress(<span class="string">"-&gt;"</span>)</div><div class="line">semicolon = Suppress(<span class="string">";"</span>)</div><div class="line">word = Word(alphas)</div><div class="line">key = word</div><div class="line">value = Word(alphanums)</div><div class="line">field_type = oneOf(<span class="string">"CharField EmailField PasswordField"</span>)</div><div class="line">field_name = word</div><div class="line">form_name = word.setResultsName(<span class="string">"form_name"</span>)</div><div class="line">field_property = Group(key + colon + value)</div><div class="line">field = Group(field_name + colon + field_type + Optional(arrow + OneOrMore(field_property) + semicolon).setParseAction(</div><div class="line">        convert_prop_to_dict))</div><div class="line">form = form_name + newline + OneOrMore(field).setResultsName(<span class="string">"form_field"</span>)</div><div class="line">input_form = <span class="string">'''</span></div><div class="line"><span class="string">UserForm</span></div><div class="line"><span class="string">username:CharField -&gt; label:Username size:25;</span></div><div class="line"><span class="string">email:EmailField -&gt; size:32;</span></div><div class="line"><span class="string">password:PasswordField;</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">External DSL</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_field_html</span><span class="params">(field)</span>:</span></div><div class="line">    properties = field[<span class="number">2</span>]</div><div class="line">    label = properties[<span class="string">"label"</span>] <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> properties <span class="keyword">else</span> field[<span class="number">0</span>]</div><div class="line">    label_html = <span class="string">"&lt;label&gt;"</span> + label + <span class="string">"&lt;/label&gt;"</span></div><div class="line">    attributes = &#123;<span class="string">"name"</span>: field[<span class="number">0</span>]&#125;</div><div class="line">    attributes.update(properties)</div><div class="line">    <span class="keyword">if</span> field[<span class="number">1</span>] == <span class="string">"CharField"</span> <span class="keyword">or</span> field[<span class="number">1</span>] == <span class="string">"EmailField"</span>:</div><div class="line">        attributes[<span class="string">"type"</span>] = <span class="string">"text"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        attributes[<span class="string">"type"</span>] = <span class="string">"password"</span></div><div class="line">    <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> attributes:</div><div class="line">        <span class="keyword">del</span> attributes[<span class="string">"label"</span>]</div><div class="line">    attributes_html = <span class="string">" "</span>.join([name + <span class="string">"='"</span> + value + <span class="string">"'"</span> <span class="keyword">for</span> name, value <span class="keyword">in</span> attributes.items()])</div><div class="line">    field_html = <span class="string">"&lt;input "</span> + attributes_html + <span class="string">"/&gt;"</span></div><div class="line">    <span class="keyword">return</span> label_html + field_html + <span class="string">"&lt;br/&gt;"</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(form)</span>:</span></div><div class="line">    fields_html = <span class="string">""</span>.join([get_field_html(field) <span class="keyword">for</span> field <span class="keyword">in</span> form.form_field])</div><div class="line">    <span class="keyword">return</span> <span class="string">"&lt;form id='"</span> + form.form_name.lower() + <span class="string">"'&gt;"</span> + fields_html + <span class="string">"&lt;/form&gt;"</span></div><div class="line">print(render(form.parseString(input_form)))</div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">Internal DSL</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlElement</span><span class="params">(object)</span>:</span></div><div class="line">    default_attributes = &#123;&#125;</div><div class="line">    tag = <span class="string">"unknown_tag"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        self.attributes = kwargs</div><div class="line">        self.attributes.update(self.default_attributes)</div><div class="line">        self.children = args</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        attribute_html = <span class="string">" "</span>.join([<span class="string">"&#123;&#125;='&#123;&#125;'"</span>.format(name, value)</div><div class="line">                                   <span class="keyword">for</span> name, value <span class="keyword">in</span> self.attributes.items()])</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.children:</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;&#125; &#123;&#125;/&gt;"</span>.format(self.tag, attribute_html)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            children_html = <span class="string">""</span>.join([str(child) <span class="keyword">for</span> child <span class="keyword">in</span> self.children])</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;&#125; &#123;&#125;&gt;&#123;&#125;&lt;/&#123;&#125;&gt;"</span>.format(self.tag, attribute_html, children_html, self.tag)</div><div class="line"><span class="comment"># print(HtmlElement(id="test"))</span></div><div class="line"><span class="comment"># &lt;unknown_tag id='test'/&gt;</span></div><div class="line"><span class="comment"># print (HtmlElement(HtmlElement(name="test"), id="id"))</span></div><div class="line"><span class="comment"># &lt;unknown_tag id='id'&gt;&lt;unknown_tag name='test'/&gt;&lt;/unknown_tag&gt;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputElement</span><span class="params">(HtmlElement)</span>:</span></div><div class="line">    tag = <span class="string">"input"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        HtmlElement.__init__(self, *args, **kwargs)</div><div class="line">        self.label = self.attributes[<span class="string">"label"</span>] <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> self.attributes <span class="keyword">else</span> self.attributes[<span class="string">"name"</span>]</div><div class="line">        <span class="keyword">if</span> <span class="string">"label"</span> <span class="keyword">in</span> self.attributes:</div><div class="line">            <span class="keyword">del</span> self.attributes[<span class="string">"label"</span>]</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        label_html = <span class="string">"&lt;label&gt;&#123;&#125;&lt;/label&gt;"</span>.format(self.label)</div><div class="line">        <span class="keyword">return</span> label_html + HtmlElement.__str__(self) + <span class="string">"&lt;br/&gt;"</span></div><div class="line"><span class="comment"># print(InputElement(name="username"))</span></div><div class="line"><span class="comment"># &lt;label&gt;username&lt;/label&gt;&lt;input name='username'/&gt;&lt;br/&gt;</span></div><div class="line"><span class="comment"># print(InputElement(name="username", label="User ID"))</span></div><div class="line"><span class="comment"># &lt;label&gt;User ID&lt;/label&gt;&lt;input name='username'/&gt;&lt;br/&gt;</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Form</span><span class="params">(HtmlElement)</span>:</span></div><div class="line">    tag = <span class="string">"form"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharField</span><span class="params">(InputElement)</span>:</span></div><div class="line">    default_attributes = &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailField</span><span class="params">(CharField)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordField</span><span class="params">(InputElement)</span>:</span></div><div class="line">    default_attributes = &#123;<span class="string">"type"</span>: <span class="string">"password"</span>&#125;</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(form)</span>:</span></div><div class="line">    field_dict = &#123;<span class="string">"CharField"</span>: CharField, <span class="string">"EmailField"</span>:</div><div class="line">        EmailField, <span class="string">"PasswordField"</span>: PasswordField&#125;</div><div class="line">    fields = [field_dict[field[<span class="number">1</span>]](name=field[<span class="number">0</span>], **field[<span class="number">2</span>]) <span class="keyword">for</span> field <span class="keyword">in</span> form.form_field]</div><div class="line">    <span class="keyword">return</span> Form(*fields, id=form.form_name.lower())</div><div class="line">print(render(form.parseString(input_form)))</div></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Vincent Zhong</p>
              <p class="site-description motion-element" itemprop="description">Share my favorite</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">224</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wax8280" target="_blank" title="GitHub"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent Zhong</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.0.4</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
